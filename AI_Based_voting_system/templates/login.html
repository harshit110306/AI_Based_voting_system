<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login | E-Voting System</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body {
      margin: 0;
      font-family: "Poppins", sans-serif;
      background-image: url('static/assets/login.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-attachment: fixed;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .login-card {
      color: #fff;
      border-radius: 15px;
      padding: 35px 25px;
      width: 100%;
      max-width: 380px;
    }

    .login-card h1 {
      font-size: 28px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 25px;
      color: #ffc107;
    }

    /* Floating label group */
    .input-group-custom {
      position: relative;
      margin-bottom: 30px;
    }

    .input-group-custom input {
      background: transparent;
      border: none;
      border-bottom: 2px solid #777;
      border-radius: 0;
      color: #fff;
      font-size: 16px;
      padding: 12px 5px 6px; /* extra top padding for label gap */
      width: 100%;
      outline: none;
      transition: border-color 0.3s ease;
    }

    .input-group-custom label {
      position: absolute;
      top: 12px;
      left: 5px;
      color: #ffffffff;
      font-size: 15px;
      pointer-events: none;
      transition: 0.3s ease all;
    }

    /* Focus or filled */
    .input-group-custom input:focus,
    .input-group-custom input:not(:placeholder-shown) {
      border-bottom: 2px solid #ffffffff;
    }

    .input-group-custom input:focus + label,
    .input-group-custom input:not(:placeholder-shown) + label {
      top: -10px;
      left: 5px;
      font-size: 13px;
      color: #ffffffff;
      background-color: transparent;
    }

    /* Password eye icon */
    .password-container {
      position: relative;
    }

    .eye-icon {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: #ffffffff;
      font-size: 18px;
    }

    /* CAPTCHA section */
    .captcha {
      margin-top: 10px;
    }

    .captcha-box {
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 2px solid #555;
      padding: 8px 0;
      margin-bottom: 10px;
    }

    .captcha-text {
      font-size: 22px;
      font-weight: 600;
      letter-spacing: 4px;
      color:  #ffffffff;
      user-select: none;
    }

    .refresh-btn {
      border: none;
      background: none;
      color: #000000ff;
      font-size: 2rem;
       font-weight: 1000;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .refresh-btn:hover {
      transform: rotate(180deg);
    }

    /* Buttons */
    .btn-custom {
      border-radius: 30px;
      font-weight: 500;
      font-size: 15px;
      transition: all 0.3s ease;
    }

    .btn-login {
      background-color: #ffc107;
      color: #000;
    }

    .btn-login:hover {
      background-color: #e0a800;
    }

    .btn-home {
      background-color: #f44336;
      color: #fff;
    }

    .btn-home:hover {
      background-color: #d32f2f;
    }

    .toggle-link {
      text-align: center;
      margin-top: 15px;
    }

    .toggle-link a {
      color: #ffc107;
      text-decoration: none;
    }

    .toggle-link a:hover {
      text-decoration: underline;
    }

    @media (max-width: 576px) {
      .login-card {
        width: 90%;
        padding: 25px 20px;
      }
    }
  </style>
</head>

<body>
  <div class="login-card">
    <h1>Sign in</h1>
    <form action="login" method="POST">
       {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <div class="flashes mb-3 text-center">
          {% for category, message in messages %}
            <div class="alert alert-warning text-dark fw-bold">{{ message }}</div>
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}
      
      <!-- Username -->
      <div class="input-group-custom">
        <input type="text" id="login-username" name="username" required placeholder=" ">
        <label for="login-username">Username</label>
      </div>

      <!-- Password -->
      <div class="input-group-custom password-container">
        <input type="password" id="login-password" name="password" required placeholder=" ">
        <label for="login-password">Password</label>
        <i class="bi bi-eye eye-icon" id="eye-password" onclick="togglePassword('login-password', 'eye-password')"></i>
      </div>

      <!-- CAPTCHA -->
      <div class="captcha">
        <div class="captcha-box">
          <span id="captcha-preview" class="captcha-text"></span>
          <button type="button" class="refresh-btn" onclick="generateCaptcha()">
            <i class="bi bi-arrow-clockwise"></i>
          </button>
        </div>
        <div class="input-group-custom">
          <input type="text" id="captcha-input" name="captcha-input" required placeholder=" ">
          <label for="captcha-input">Enter CAPTCHA</label>
        </div>
        <input type="hidden" id="captcha-value" name="captcha-value">
      </div>

      <input type="hidden" id="user-type-input" name="user_type">

      <div class="d-flex justify-content-between mt-4">
        <input type="submit" value="Sign in" class="btn btn-login btn-custom w-50 me-2">
        <a href="{{ url_for('home') }}" class="btn btn-home btn-custom w-50">Cancle</a>
      </div>

      <p class="toggle-link mt-3"><a href="{{ url_for('forget') }}">Forgot password?</a></p>
      <p class="toggle-link">Donâ€™t have an account? <a href="{{ url_for('regstation') }}">Sign Up</a></p>
    </form>
  </div>

  <script>
    // CAPTCHA Generator
    function generateCaptcha() {
      const chars = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";
      let captcha = "";
      for (let i = 0; i < 6; i++) {
        captcha += chars[Math.floor(Math.random() * chars.length)];
      }
      document.getElementById("captcha-preview").innerText = captcha;
      document.getElementById("captcha-value").value = captcha;
    }

    // Toggle password visibility
    function togglePassword(id, eyeId) {
      const input = document.getElementById(id);
      const icon = document.getElementById(eyeId);
      if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye", "bi-eye-slash");
      } else {
        input.type = "password";
        icon.classList.replace("bi-eye-slash", "bi-eye");
      }
    }

    // Detect user type
        function handleUserType() {
            const username = document.getElementById('login-username').value;
            let userType = '';
            if (/^\d+$/.test(username)) {
                userType = 'Admin';
            } else if (/^[A-Za-z]+$/.test(username)) {
                userType = 'Candidate';
            } else if (/^[A-Za-z0-9]+$/.test(username)) {
                userType = 'User';
            }
            document.getElementById('user-type-input').value = userType;
        }

        // Initialize
        window.onload = generateCaptcha;

    window.onload = generateCaptcha;
  </script>
</body>
</html>
